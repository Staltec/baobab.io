{"version":3,"sources":["../src/index.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAGA,IAAM,qBAAqB,GAAG,SAAS,CAAC;;AAExC,IAAM,cAAc,GAAG,CACnB,KAAK,EACL,OAAO,EACP,MAAM,EACN,SAAS,EACT,QAAQ,EACR,QAAQ,EACR,OAAO,EACP,WAAW,CACd,CAAC;;IAGI,QAAQ;cAAR,QAAQ;;AAEV,aAFE,QAAQ,CAEG,WAAW,EAAE,IAAI,EAAE;8BAF9B,QAAQ;;2EAAR,QAAQ,aAGA,WAAW,EAAE,IAAI;;AAEvB,cAAK,MAAM,GAAG,sBAAG,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;AACzC,cAAK,MAAM,CAAC,EAAE,CAAC,cAAc,EAAE;mBAAM,MAAK,GAAG,CAAC,qBAAqB,EAAE,IAAI,CAAC;SAAA,CAAE,CAAC;AAC7E,cAAK,MAAM,CAAC,EAAE,CAAC,WAAW,EAAE;mBAAM,MAAK,GAAG,CAAC,qBAAqB,EAAE,KAAK,CAAC;SAAA,CAAE,CAAC;;KAC9E;;iBARC,QAAQ;;6BAUiB;;;gBAAvB,SAAS,yDAAG,GAAG;gBAAE,IAAI;;AACrB,gBAAI,MAAM,GAAG,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC;;AAE7D,gBAAI,CAAC,MAAM,EAAE;AACT,sBAAM,GAAG,sBAAG,MAAM,CAAC,QAAQ,CAAC,MAAM,GAAG,SAAS,EAAE,IAAI,CAAC,CAAC;;AAEtD,8BAAc,CAAC,OAAO,CAAC,UAAC,MAAM,EAAK;AAC/B,0BAAM,CAAC,EAAE,CAAC,qBAAqB,GAAG,MAAM,EAAE;+BAAY,OAAK,MAAM,OAAC,mBAAQ;qBAAA,CAAC,CAAC;iBACnF,CAAC,CAAC;;AAEH,oBAAI,CAAC,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC;AACzC,oBAAI,CAAC,WAAW,CAAC,SAAS,CAAC,GAAG,MAAM,CAAC;aACxC;;AAED,mBAAO;AACH,sBAAM,EAAE,MAAM;AACd,oBAAI,EAAE,cAAC,GAAG,EAAgB;sDAAX,MAAM;AAAN,8BAAM;;;AAGjB,2BAAO,cAAc,CAAC,MAAM,CAAC,UAAC,IAAI,EAAE,MAAM,EAAK;AAC3C,4BAAI,CAAC,MAAM,CAAC,GAAG,UAAC,IAAI;;;mCAAK,WAAA,MAAM,EAAC,IAAI,MAAA,WAAC,GAAG,EAAE,qBAAqB,GAAG,MAAM,EAAE,IAAI,SAAK,MAAM,EAAC;yBAAA,CAAC;AAC3F,+BAAO,IAAI,CAAC;qBAEf,EAAE;AACC,4BAAI,EAAE;;;mCAAO,YAAA,MAAM,EAAC,IAAI,MAAA,YAAC,GAAG,SAAK,MAAM,EAAC;yBAAA;qBAC3C,CAAC,CAAC;iBACN;aACJ,CAAA;SACJ;;;WAtCC,QAAQ;;;kBA2CC,QAAQ","file":"index.js","sourcesContent":["import Baobab from \"baobab\";\r\nimport io from \"socket.io-client\";\r\n\r\nconst BAOBAB_MESSAGE_PREFIX = 'baobab:';\r\n\r\nconst BAOBAB_METHODS = [\r\n    'set',\r\n    'unset',\r\n    'push',\r\n    'unshift',\r\n    'splice',\r\n    'concat',\r\n    'merge',\r\n    'deepMerge'\r\n];\r\n\r\n\r\nclass BaobabIO extends Baobab {\r\n\r\n    constructor (initialData, opts) {\r\n        super(initialData, opts);\r\n\r\n        this.socket = io(window.location.origin);\r\n        this.socket.on('reconnecting', () => this.set('_socketReconnecting', true) );\r\n        this.socket.on('reconnect', () => this.set('_socketReconnecting', false) );\r\n    }\r\n\r\n    io (namespace = '/', opts) {\r\n        let socket = this._namespaces && this._namespaces[namespace];\r\n\r\n        if (!socket) {\r\n            socket = io(window.location.origin + namespace, opts);\r\n\r\n            BAOBAB_METHODS.forEach((method) => {\r\n                socket.on(BAOBAB_MESSAGE_PREFIX + method, (...arg) => this[method](...arg));\r\n        });\r\n\r\n        if (!this._namespaces) this._namespaces = {};\r\n            this._namespaces[namespace] = socket;\r\n        }\r\n\r\n        return {\r\n            socket: socket,\r\n            emit: (cmd, ...params) => {\r\n\r\n\r\n                return BAOBAB_METHODS.reduce((memo, method) => {\r\n                    memo[method] = (path) => socket.emit(cmd, BAOBAB_MESSAGE_PREFIX + method, path, ...params);\r\n                    return memo;\r\n\r\n                }, {\r\n                    void: () =>  socket.emit(cmd, ...params)\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n}\r\n\r\n\r\nexport default BaobabIO;"]}