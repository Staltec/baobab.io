{"version":3,"sources":["../src/index.js"],"names":[],"mappings":"AAAA,OAAO,MAAM,MAAM,QAAQ,CAAC;AAC5B,OAAO,EAAE,MAAM,kBAAkB,CAAC;;AAElC,MAAM,qBAAqB,GAAG,SAAS,CAAC;;AAExC,MAAM,cAAc,GAAG,CACnB,KAAK,EACL,OAAO,EACP,MAAM,EACN,SAAS,EACT,QAAQ,EACR,QAAQ,EACR,OAAO,EACP,WAAW,CACd,CAAC;;AAGF,MAAM,QAAQ,SAAS,MAAM,CAAC;;AAE1B,eAAW,CAAE,WAAW,EAAE,IAAI,EAAE;AAC5B,aAAK,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;;AAEzB,YAAI,CAAC,MAAM,GAAG,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;AACzC,YAAI,CAAC,MAAM,CAAC,EAAE,CAAC,cAAc,EAAE,MAAM,IAAI,CAAC,GAAG,CAAC,qBAAqB,EAAE,IAAI,CAAC,CAAE,CAAC;AAC7E,YAAI,CAAC,MAAM,CAAC,EAAE,CAAC,WAAW,EAAE,MAAM,IAAI,CAAC,GAAG,CAAC,qBAAqB,EAAE,KAAK,CAAC,CAAE,CAAC;KAC9E;;AAED,MAAE,CAAE,SAAS,GAAG,GAAG,EAAE,IAAI,EAAE;AACvB,YAAI,MAAM,GAAG,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC;;AAE7D,YAAI,CAAC,MAAM,EAAE;AACT,kBAAM,GAAG,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,GAAG,SAAS,EAAE,IAAI,CAAC,CAAC;;AAEtD,0BAAc,CAAC,OAAO,CAAC,AAAC,MAAM,IAAK;AAC/B,sBAAM,CAAC,EAAE,CAAC,qBAAqB,GAAG,MAAM,EAAE,CAAC,GAAG,GAAG,KAAK,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC;aACnF,CAAC,CAAC;;AAEC,gBAAI,CAAC,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC;AAC7C,gBAAI,CAAC,WAAW,CAAC,SAAS,CAAC,GAAG,MAAM,CAAC;SACxC;;AAED,eAAO;AACH,kBAAM,EAAE,MAAM;AACd,gBAAI,EAAE,CAAC,GAAG,EAAE,GAAG,MAAM,KAAK;;AAGtB,uBAAO,cAAc,CAAC,MAAM,CAAC,CAAC,IAAI,EAAE,MAAM,KAAK;AAC3C,wBAAI,CAAC,MAAM,CAAC,GAAG,AAAC,IAAI,IAAK,MAAM,CAAC,IAAI,CAAC,GAAG,EAAE,qBAAqB,GAAG,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,CAAC,CAAC;AAC3F,2BAAO,IAAI,CAAC;iBAEf,EAAE;AACC,0BAAM,EAAE,MAAO,MAAM,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,MAAM,CAAC;iBAC7C,CAAC,CAAC;aACN;SACJ,CAAA;KACJ;;CAEJ;;AAGD,eAAe,QAAQ,CAAC","file":"index.js","sourcesContent":["import Baobab from \"baobab\";\r\nimport io from \"socket.io-client\";\r\n\r\nconst BAOBAB_MESSAGE_PREFIX = 'baobab:';\r\n\r\nconst BAOBAB_METHODS = [\r\n    'set',\r\n    'unset',\r\n    'push',\r\n    'unshift',\r\n    'splice',\r\n    'concat',\r\n    'merge',\r\n    'deepMerge'\r\n];\r\n\r\n\r\nclass BaobabIO extends Baobab {\r\n\r\n    constructor (initialData, opts) {\r\n        super(initialData, opts);\r\n\r\n        this.socket = io(window.location.origin);\r\n        this.socket.on('reconnecting', () => this.set('_socketReconnecting', true) );\r\n        this.socket.on('reconnect', () => this.set('_socketReconnecting', false) );\r\n    }\r\n\r\n    io (namespace = '/', opts) {\r\n        let socket = this._namespaces && this._namespaces[namespace];\r\n\r\n        if (!socket) {\r\n            socket = io(window.location.origin + namespace, opts);\r\n\r\n            BAOBAB_METHODS.forEach((method) => {\r\n                socket.on(BAOBAB_MESSAGE_PREFIX + method, (...arg) => this[method](...arg));\r\n        });\r\n\r\n            if (!this._namespaces) this._namespaces = {};\r\n            this._namespaces[namespace] = socket;\r\n        }\r\n\r\n        return {\r\n            socket: socket,\r\n            emit: (cmd, ...params) => {\r\n\r\n\r\n                return BAOBAB_METHODS.reduce((memo, method) => {\r\n                    memo[method] = (path) => socket.emit(cmd, BAOBAB_MESSAGE_PREFIX + method, path, ...params);\r\n                    return memo;\r\n\r\n                }, {\r\n                    silent: () =>  socket.emit(cmd, ...params)\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n}\r\n\r\n\r\nexport default BaobabIO;"]}